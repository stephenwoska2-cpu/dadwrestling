<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wrestling Drill Timer</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 30px;
            text-align: center;
        }

        .setup-screen, .drill-screen {
            width: 100%;
            max-width: 500px;
        }

        .drill-screen {
            display: none;
            text-align: center;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #a0a0a0;
        }

        .radio-group {
            display: flex;
            gap: 15px;
        }

        .radio-option {
            flex: 1;
            padding: 15px 20px;
            background: #2a2a4a;
            border: 2px solid #3a3a6a;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-size: 1.2rem;
            transition: all 0.2s;
        }

        .radio-option:hover {
            border-color: #5a5a9a;
        }

        .radio-option.selected {
            border-color: #6c63ff;
            background: #3a3a6a;
        }

        .radio-option input {
            display: none;
        }

        .slider-container {
            background: #2a2a4a;
            padding: 20px;
            border-radius: 10px;
        }

        .slider-value {
            font-size: 2rem;
            font-weight: bold;
            color: #6c63ff;
            text-align: center;
            margin-bottom: 15px;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #1a1a2e;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #6c63ff;
            cursor: pointer;
        }

        .start-btn, .control-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.3rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
        }

        .start-btn {
            background: linear-gradient(135deg, #6c63ff 0%, #5a54d4 100%);
            color: white;
            margin-top: 20px;
        }

        .start-btn:hover {
            transform: scale(1.02);
        }

        .start-btn:active {
            transform: scale(0.98);
        }

        /* Drill Screen Styles */
        .combo-display {
            background: #2a2a4a;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
        }

        .combo-text {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .combo-progress {
            color: #a0a0a0;
            font-size: 1.1rem;
        }

        .timer-display {
            background: #1a1a2e;
            border-radius: 50%;
            width: 200px;
            height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            border: 4px solid #3a3a6a;
        }

        .timer-value {
            font-size: 4rem;
            font-weight: bold;
        }

        .timer-label {
            font-size: 1rem;
            color: #a0a0a0;
            margin-top: 5px;
        }

        .status-text {
            font-size: 1.5rem;
            margin-bottom: 25px;
            min-height: 2rem;
        }

        .status-setup { color: #ffd93d; }
        .status-set { color: #ff6b6b; }
        .status-wrestling { color: #6bcb77; }
        .status-done { color: #6c63ff; }

        .controls {
            display: flex;
            gap: 15px;
        }

        .control-btn {
            flex: 1;
        }

        .pause-btn {
            background: #ffd93d;
            color: #1a1a2e;
        }

        .stop-btn {
            background: #ff6b6b;
            color: white;
        }

        .control-btn:hover {
            opacity: 0.9;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Setup Screen -->
    <div class="setup-screen" id="setupScreen">
        <h1>ðŸ¤¼ Wrestling Drill Timer</h1>

        <div class="form-group">
            <label>Number of Wrestlers</label>
            <div class="radio-group">
                <label class="radio-option selected" data-value="3">
                    <input type="radio" name="groupSize" value="3" checked>
                    3 Wrestlers
                </label>
                <label class="radio-option" data-value="4">
                    <input type="radio" name="groupSize" value="4">
                    4 Wrestlers
                </label>
            </div>
        </div>

        <div class="form-group">
            <label>Round Duration</label>
            <div class="slider-container">
                <div class="slider-value" id="durationValue">45 seconds</div>
                <input type="range" id="durationSlider" min="30" max="60" value="45" step="5">
            </div>
        </div>

        <button class="start-btn" id="startBtn">Start Drill</button>
    </div>

    <!-- Drill Screen -->
    <div class="drill-screen" id="drillScreen">
        <h1>ðŸ¤¼ Wrestling Drill</h1>

        <div class="combo-display">
            <div class="combo-text" id="comboText">1 up, 2 down</div>
            <div class="combo-progress" id="comboProgress">Round 1 of 6</div>
        </div>

        <div class="timer-display">
            <div class="timer-value" id="timerValue">45</div>
            <div class="timer-label" id="timerLabel">seconds</div>
        </div>

        <div class="status-text" id="statusText"></div>

        <div class="controls">
            <button class="control-btn pause-btn" id="pauseBtn">Pause</button>
            <button class="control-btn stop-btn" id="stopBtn">Stop</button>
        </div>
    </div>

    <script>
        // State
        let groupSize = 3;
        let roundDuration = 45;
        let combinations = [];
        let currentComboIndex = 0;
        let isPaused = false;
        let currentTimer = null;
        let remainingTime = 0;
        let currentPhase = ''; // 'setup', 'set', 'wrestling'

        // Audio context for whistle
        let audioContext = null;

        // DOM Elements
        const setupScreen = document.getElementById('setupScreen');
        const drillScreen = document.getElementById('drillScreen');
        const durationSlider = document.getElementById('durationSlider');
        const durationValue = document.getElementById('durationValue');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const comboText = document.getElementById('comboText');
        const comboProgress = document.getElementById('comboProgress');
        const timerValue = document.getElementById('timerValue');
        const timerLabel = document.getElementById('timerLabel');
        const statusText = document.getElementById('statusText');
        const radioOptions = document.querySelectorAll('.radio-option');

        // Initialize audio context on user interaction
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Generate whistle sound
        function playWhistle() {
            if (!audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.setValueAtTime(2800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(2400, audioContext.currentTime + 0.5);

            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // Text-to-speech
        function speak(text) {
            return new Promise((resolve) => {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9;
                utterance.onend = resolve;
                utterance.onerror = resolve;
                speechSynthesis.speak(utterance);
            });
        }

        // Generate all combinations
        function generateCombinations(size) {
            const combos = [];
            for (let i = 1; i <= size; i++) {
                for (let j = 1; j <= size; j++) {
                    if (i !== j) {
                        combos.push({ up: i, down: j });
                    }
                }
            }
            return combos;
        }

        // Update UI
        function updateDisplay() {
            const combo = combinations[currentComboIndex];
            comboText.textContent = `${combo.up} up, ${combo.down} down`;
            comboProgress.textContent = `Round ${currentComboIndex + 1} of ${combinations.length}`;
        }

        // Sleep helper
        function sleep(ms) {
            return new Promise(resolve => {
                currentTimer = setTimeout(resolve, ms);
            });
        }

        // Countdown with pause support
        async function countdown(seconds, label) {
            remainingTime = seconds;
            timerLabel.textContent = label;

            while (remainingTime > 0) {
                if (isPaused) {
                    await new Promise(resolve => {
                        const checkPause = setInterval(() => {
                            if (!isPaused) {
                                clearInterval(checkPause);
                                resolve();
                            }
                        }, 100);
                    });
                }

                timerValue.textContent = remainingTime;
                await sleep(1000);
                remainingTime--;
            }
            timerValue.textContent = '0';
        }

        // Run single combo
        async function runCombo() {
            const combo = combinations[currentComboIndex];
            updateDisplay();

            // Phase 1: Announce and setup (7 seconds)
            currentPhase = 'setup';
            statusText.textContent = 'Get in position...';
            statusText.className = 'status-text status-setup';

            await speak(`${combo.up} up, ${combo.down} down`);
            await countdown(7, 'setup');

            // Phase 2: SET (1 second)
            currentPhase = 'set';
            statusText.textContent = 'SET!';
            statusText.className = 'status-text status-set';

            await speak('SET');
            await countdown(1, 'ready');

            // Whistle to start
            playWhistle();

            // Phase 3: Wrestling
            currentPhase = 'wrestling';
            statusText.textContent = 'WRESTLE!';
            statusText.className = 'status-text status-wrestling';

            await countdown(roundDuration, 'wrestling');

            // Whistle to end
            playWhistle();
        }

        // Main drill loop
        async function runDrill() {
            combinations = generateCombinations(groupSize);
            currentComboIndex = 0;
            isPaused = false;

            setupScreen.style.display = 'none';
            drillScreen.style.display = 'block';

            while (currentComboIndex < combinations.length) {
                await runCombo();
                currentComboIndex++;

                if (currentComboIndex < combinations.length) {
                    await sleep(500); // Brief pause between combos
                }
            }

            // Done
            statusText.textContent = 'DRILL COMPLETE!';
            statusText.className = 'status-text status-done';
            timerValue.textContent = 'âœ“';
            timerLabel.textContent = 'done';
            comboText.textContent = 'All rounds finished';
            comboProgress.textContent = `${combinations.length} rounds completed`;

            await speak('Drill complete!');
        }

        // Stop drill
        function stopDrill() {
            if (currentTimer) {
                clearTimeout(currentTimer);
            }
            speechSynthesis.cancel();
            isPaused = false;
            currentComboIndex = combinations.length; // End the loop

            drillScreen.style.display = 'none';
            setupScreen.style.display = 'block';
        }

        // Event Listeners
        radioOptions.forEach(option => {
            option.addEventListener('click', () => {
                radioOptions.forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                option.querySelector('input').checked = true;
                groupSize = parseInt(option.dataset.value);
            });
        });

        durationSlider.addEventListener('input', () => {
            roundDuration = parseInt(durationSlider.value);
            durationValue.textContent = `${roundDuration} seconds`;
        });

        startBtn.addEventListener('click', () => {
            initAudio();
            runDrill();
        });

        pauseBtn.addEventListener('click', () => {
            isPaused = !isPaused;
            pauseBtn.textContent = isPaused ? 'Resume' : 'Pause';

            if (isPaused) {
                speechSynthesis.pause();
            } else {
                speechSynthesis.resume();
            }
        });

        stopBtn.addEventListener('click', stopDrill);
    </script>
</body>
</html>
